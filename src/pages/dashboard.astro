---
import { resolveWeek } from "../domain/resolveWeek";
import { getTodayDay } from "../utils/today";
import { isWorkingNow } from "../utils/isWorkingNow";

const data = resolveWeek(new Date());
const today = getTodayDay();

// empleados que trabajan hoy
const workingToday = data.filter((emp) => emp.dias[today]?.trabaja);
---

<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Dashboard Turnos</title>
    <meta http-equiv="refresh" content="600" />
    <!-- auto refresh cada 60s -->
    <link rel="stylesheet" href="/src/styles/tailwind.css" />
  </head>
  <body class="bg-base text-slate-100 min-h-screen p-8 text-[18px]">
    <header class="mb-6">
      <h1 class="text-3xl font-bold tracking-tight">Turnos – Hoy</h1>
      <p class="text-lg capitalize text-accent">
        {today}
      </p>
    </header>

    <section class="grid grid-cols-2 xl:grid-cols-3 gap-6">
      {
        workingToday.map((emp) => {
          const d = emp.dias[today];
          const workingNow = isWorkingNow(d.entrada, d.salida);

          return (
            <article class="bg-surface rounded-2xl p-6 border border-slate-800">
              <div class="flex justify-between items-start mb-4">
                <h2 class="text-xl font-semibold">{emp.empleado}</h2>
                <span class="text-sm text-slate-400">Turno {emp.turno}</span>
              </div>

              <p class="text-lg">
                {d.entrada} – {d.salida}
              </p>

              {d.edificio && (
                <p class="mt-2 text-sm bg-slate-800 inline-block px-3 py-1 rounded">
                  {d.edificio}
                </p>
              )}

              {workingNow && (
                <p class="mt-4 text-emerald-400 text-sm font-semibold">
                  ● Trabajando ahora
                </p>
              )}
            </article>
          );
        })
      }
    </section>
  </body>
</html>
